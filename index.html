<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="color-scheme" content="dark">
    <title>Vanilla - Blackjack Practice</title>
    <meta name="description"
        content="Practice blackjack with Vanilla - fair shuffling, card counting trainer, and strategy training.">

    <link rel="icon" type="image/png" href="assets/logo.png">
    <link rel="apple-touch-icon" href="assets/logo.png">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Blackjack">

    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload"
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap"
        as="style">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" as="style">

    <!-- Fonts & Icons -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Core styles with full layout -->
    <link rel="stylesheet" href="css/styles.css">
    <!-- Modern theme overrides -->
    <link rel="stylesheet" href="css/styles-modern.css">
    <!-- Action button updates -->
    <link rel="stylesheet" href="css/new-layout.css">
</head>

<body>
    <div class="app-container">
        <!-- Header - Compact modern design -->
        <header class="header" role="banner">
            <div class="header-left">
                <div class="logo">
                    <img src="assets/logo.png" alt="Vanilla" class="logo-img">
                    <span class="logo-text">Vanilla</span>
                </div>

                <!-- Card Count Display (hidden by default) -->
                <div class="count-display" id="count-display" style="display: none;" aria-live="polite">
                    <div class="count-item">
                        <span class="count-label">RC</span>
                        <span class="count-value" id="running-count">0</span>
                    </div>
                    <div class="count-item">
                        <span class="count-label">TC</span>
                        <span class="count-value" id="true-count">0</span>
                    </div>
                </div>
            </div>

            <div class="header-center">
                <div class="bankroll-display">
                    <span class="bankroll-amount">$<span id="balance">10,000</span></span>
                    <span class="bankroll-stat win" id="stats-winrate" title="Win Rate">52%</span>
                    <span class="bankroll-stat profit" id="stats-profit" title="Session Profit">+$0</span>
                    <span class="bankroll-stat hands hide-mobile" id="stats-hands" title="Hands Played">0</span>
                </div>
            </div>

            <div class="header-right">
                <button type="button" class="icon-btn header-reshuffle-btn" id="btn-reshuffle-mobile"
                    title="Reshuffle Deck" aria-label="Reshuffle Deck">
                    <i class="fa-solid fa-rotate"></i>
                </button>
                <button type="button" class="icon-btn" id="btn-add-chips" title="Add Chips" aria-label="Add Chips">
                    <i class="fa-solid fa-coins"></i>
                </button>
                <button type="button" class="icon-btn" id="btn-settings" title="Settings" aria-label="Settings">
                    <i class="fa-solid fa-gear"></i>
                </button>
            </div>
        </header>

        <!-- Main Game Area - Centered, no sidebars -->
        <main class="game-main" role="main" data-state="betting">
            <div class="game-container" data-state="betting">
                <!-- Game Table - Three Zone Layout -->
                <div class="game-table">
                    <!-- Dealer Zone -->
                    <div class="table-zone dealer-zone">
                        <span class="zone-label">DEALER</span>
                        <div class="cards-area" id="dealer-cards" role="list" aria-label="Dealer's Cards"></div>
                        <div class="hand-badge" id="dealer-value" aria-live="polite">-</div>
                    </div>

                    <!-- Table Center - Bet Display & Hint -->
                    <div class="table-center">
                        <div class="bet-indicator" id="bet-indicator">
                            <div class="bet-indicator-label">BET</div>
                            <div class="bet-indicator-value">$<span id="current-bet-value">0</span></div>
                        </div>
                        <!-- Chip stacks visual (only during betting) -->
                        <div class="chip-stacks-container" id="chip-stacks-container"></div>
                        <!-- Hint Display -->
                        <div class="hint-badge" id="hint-container" style="display: none;" aria-live="polite">
                            <i class="fa-solid fa-lightbulb"></i>
                            <span id="hint-text">HIT</span>
                        </div>
                        <!-- Betting prompt (only during betting with no bet) -->
                        <div class="betting-prompt" id="betting-prompt">Place Your Bet</div>
                    </div>

                    <!-- Player Zone -->
                    <div class="table-zone player-zone">
                        <div class="player-hands-container" id="player-hands-container">
                            <div class="hand-wrapper" role="region" aria-label="Your Hand">
                                <div class="hand-badge" id="player-value" aria-live="polite">-</div>
                                <div class="cards-area" id="player-cards" role="list" aria-label="Your Cards"></div>
                            </div>
                        </div>
                        <span class="zone-label">YOU</span>
                    </div>
                </div>

                <!-- Deck Info - Minimalist corner display -->
                <div class="deck-info" id="deck-info">
                    <div class="deck-stat">
                        <i class="fa-solid fa-layer-group"></i>
                        <span id="cards-remaining">312</span>/<span id="cards-total">312</span>
                    </div>
                    <div class="penetration-bar" id="penetration-bar" title="Deck Penetration">
                        <div class="penetration-fill" id="penetration-fill"></div>
                        <span class="penetration-label" id="penetration-label">0%</span>
                    </div>
                    <button type="button" class="btn-reshuffle" id="btn-reshuffle" aria-label="Reshuffle Deck">
                        <i class="fa-solid fa-rotate"></i>
                        <span>Reshuffle</span>
                    </button>
                </div>
            </div>

            <!-- Unified Bottom Control Bar -->
            <div class="game-controls" id="game-controls">
                <!-- Betting Controls - Shows during betting phase -->
                <div class="betting-controls" id="betting-controls">
                    <div class="chip-row">
                        <button type="button" class="chip-btn" data-value="1" aria-label="Bet $1">
                            <div class="chip-modern chip-1"><span class="chip-amount">1</span></div>
                        </button>
                        <button type="button" class="chip-btn" data-value="5" aria-label="Bet $5">
                            <div class="chip-modern chip-5"><span class="chip-amount">5</span></div>
                        </button>
                        <button type="button" class="chip-btn" data-value="25" aria-label="Bet $25">
                            <div class="chip-modern chip-25"><span class="chip-amount">25</span></div>
                        </button>
                        <button type="button" class="chip-btn" data-value="100" aria-label="Bet $100">
                            <div class="chip-modern chip-100"><span class="chip-amount">100</span></div>
                        </button>
                        <button type="button" class="chip-btn" data-value="500" aria-label="Bet $500">
                            <div class="chip-modern chip-500"><span class="chip-amount">500</span></div>
                        </button>
                        <button type="button" class="chip-btn" data-value="1000" aria-label="Bet $1000">
                            <div class="chip-modern chip-1000"><span class="chip-amount">1K</span></div>
                        </button>
                    </div>
                    <div class="betting-actions">
                        <button type="button" class="bet-action-btn" id="btn-clear-bet" aria-label="Clear Bet">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                        <button type="button" class="bet-action-btn" id="btn-rebet" aria-label="Repeat Last Bet">
                            <i class="fa-solid fa-rotate-left"></i>
                        </button>
                        <button type="button" class="bet-action-btn bet-action-max" id="btn-max" aria-label="Max Bet">
                            MAX
                        </button>
                        <button type="button" class="btn-deal" id="btn-deal" aria-label="Deal Cards">
                            DEAL
                        </button>
                    </div>
                </div>

                <!-- Action Controls - Shows during playing phase -->
                <div class="action-controls" id="action-controls">
                    <button type="button" class="action-btn action-hit" id="btn-hit" aria-label="Hit">
                        <div class="action-icon"><i class="fa-solid fa-plus"></i></div>
                        <span class="action-label">Hit</span>
                    </button>
                    <button type="button" class="action-btn action-stand" id="btn-stand" aria-label="Stand">
                        <div class="action-icon"><i class="fa-solid fa-hand"></i></div>
                        <span class="action-label">Stand</span>
                    </button>
                    <button type="button" class="action-btn action-double" id="btn-double" aria-label="Double">
                        <div class="action-icon"><i class="fa-solid fa-coins"></i></div>
                        <span class="action-label">Double</span>
                    </button>
                    <button type="button" class="action-btn action-split" id="btn-split" aria-label="Split">
                        <div class="action-icon"><i class="fa-solid fa-scissors"></i></div>
                        <span class="action-label">Split</span>
                    </button>
                    <button type="button" class="action-btn action-surrender" id="btn-surrender" aria-label="Surrender">
                        <div class="action-icon"><i class="fa-solid fa-flag"></i></div>
                        <span class="action-label">Surrender</span>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Result Overlay -->
    <div class="result-overlay" id="result-overlay" role="dialog" aria-modal="true" aria-labelledby="result-text">
        <div class="result-card">
            <div class="result-icon" id="result-icon" aria-hidden="true"><i class="fa-solid fa-trophy"></i></div>
            <div class="result-text" id="result-text">YOU WIN!</div>
            <div class="result-amount" id="result-amount">+$100</div>
        </div>
    </div>

    <!-- Insurance Modal -->
    <div class="modal-backdrop" id="insurance-modal" role="dialog" aria-modal="true" aria-labelledby="insurance-title"
        style="display: none;">
        <div class="modal">
            <h2 class="modal-title" id="insurance-title">Insurance?</h2>
            <p class="modal-desc">Dealer is showing an Ace. Would you like to take insurance?</p>
            <p class="modal-cost">Cost: <span id="insurance-cost">$0</span> (half your bet)</p>
            <p class="modal-note">Pays 2:1 if dealer has blackjack</p>
            <div class="modal-actions">
                <button type="button" class="btn-modal btn-decline" id="btn-decline-insurance">
                    <i class="fa-solid fa-xmark"></i>
                    No Thanks
                </button>
                <button type="button" class="btn-modal btn-accept" id="btn-take-insurance">
                    <i class="fa-solid fa-shield"></i>
                    Take Insurance
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-backdrop" id="settings-modal" role="dialog" aria-modal="true" aria-labelledby="settings-title"
        style="display: none;">
        <div class="modal modal-large">
            <div class="modal-header">
                <h2 class="modal-title" id="settings-title">Settings</h2>
                <button type="button" class="modal-close" id="btn-close-settings" aria-label="Close">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <div class="settings-content">
                <div class="settings-section">
                    <h3 class="settings-section-title">Game Rules</h3>

                    <div class="setting-row">
                        <label for="setting-deck-count">Number of Decks</label>
                        <select id="setting-deck-count" class="setting-select">
                            <option value="1">1 Deck</option>
                            <option value="2">2 Decks</option>
                            <option value="4">4 Decks</option>
                            <option value="6" selected>6 Decks</option>
                            <option value="8">8 Decks</option>
                        </select>
                    </div>

                    <div class="setting-row">
                        <label for="setting-reshuffle-at">Reshuffle At</label>
                        <select id="setting-reshuffle-at" class="setting-select">
                            <option value="25">25%</option>
                            <option value="50" selected>50%</option>
                            <option value="75">75%</option>
                        </select>
                    </div>

                    <div class="setting-row">
                        <label for="setting-dealer-h17">
                            <span>Dealer Hits Soft 17</span>
                            <span class="setting-hint">Increases house edge</span>
                        </label>
                        <label class="toggle">
                            <input type="checkbox" id="setting-dealer-h17">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="setting-row">
                        <label for="toggle-hole-card">
                            <span>Dealer Hole Card</span>
                            <span class="setting-hint">Face-down card (American style)</span>
                        </label>
                        <label class="toggle">
                            <input type="checkbox" id="toggle-hole-card" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">Features</h3>

                    <div class="setting-row">
                        <label for="toggle-hints">Strategy Hints</label>
                        <label class="toggle">
                            <input type="checkbox" id="toggle-hints">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="setting-row">
                        <label for="toggle-counting">Card Counting</label>
                        <label class="toggle">
                            <input type="checkbox" id="toggle-counting">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="setting-row" id="counting-system-group" style="display: none;">
                        <label for="setting-count-system">Counting System</label>
                        <select id="setting-count-system" class="setting-select">
                            <option value="hi-lo">Hi-Lo</option>
                            <option value="ko">K-O</option>
                            <option value="omega2">Omega II</option>
                            <option value="hi-opt1">Hi-Opt I</option>
                            <option value="hi-opt2">Hi-Opt II</option>
                        </select>
                    </div>

                    <div class="setting-row">
                        <label for="toggle-autostand">Auto Stand on 21</label>
                        <label class="toggle">
                            <input type="checkbox" id="toggle-autostand" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="setting-row">
                        <label for="toggle-autobet">
                            <span>Auto-Bet</span>
                            <span class="setting-hint">Repeat last bet after each hand</span>
                        </label>
                        <label class="toggle">
                            <input type="checkbox" id="toggle-autobet">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="setting-row">
                        <label for="toggle-wrongplay">
                            <span>Wrong Play Feedback</span>
                            <span class="setting-hint">Flash when deviating from strategy</span>
                        </label>
                        <label class="toggle">
                            <input type="checkbox" id="toggle-wrongplay">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="setting-row">
                        <label for="toggle-sound">Sound Effects</label>
                        <label class="toggle">
                            <input type="checkbox" id="toggle-sound" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">Theme</h3>
                    <div class="theme-grid" id="theme-picker">
                        <button type="button" class="theme-option active" data-theme="vanilla">
                            <span class="theme-preview theme-vanilla"></span>
                            <span class="theme-name">Vanilla</span>
                        </button>
                        <button type="button" class="theme-option" data-theme="emerald">
                            <span class="theme-preview theme-emerald"></span>
                            <span class="theme-name">Emerald</span>
                        </button>
                        <button type="button" class="theme-option" data-theme="crimson">
                            <span class="theme-preview theme-crimson"></span>
                            <span class="theme-name">Crimson</span>
                        </button>
                        <button type="button" class="theme-option" data-theme="sapphire">
                            <span class="theme-preview theme-sapphire"></span>
                            <span class="theme-name">Sapphire</span>
                        </button>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="settings-section-title">Visuals</h3>
                    <div class="setting-row">
                        <label for="setting-sound-pack">Sound Pack</label>
                        <select id="setting-sound-pack" class="setting-select">
                            <option value="premium">Premium Casino</option>
                            <option value="classic">Classic Casino</option>
                            <option value="minimal">Minimalist</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label for="setting-volume">Volume</label>
                        <input type="range" id="setting-volume" class="setting-range" min="0" max="100" value="50">
                    </div>
                </div>

                <div class="settings-actions">
                    <button type="button" class="btn-settings" id="btn-reset-stats">
                        <i class="fa-solid fa-rotate-left"></i>
                        Reset Statistics
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Money Modal -->
    <div class="modal-backdrop" id="add-money-modal" role="dialog" aria-modal="true" aria-labelledby="add-money-title"
        style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="add-money-title">Add Chips</h2>
                <button type="button" class="modal-close" id="btn-close-add-money" aria-label="Close">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <div class="add-money-content">
                <div class="quick-amounts">
                    <button type="button" class="quick-amount-btn" data-amount="1000">$1,000</button>
                    <button type="button" class="quick-amount-btn" data-amount="5000">$5,000</button>
                    <button type="button" class="quick-amount-btn" data-amount="10000">$10,000</button>
                    <button type="button" class="quick-amount-btn" data-amount="50000">$50,000</button>
                </div>

                <div class="custom-amount">
                    <label for="custom-amount-input">Custom Amount</label>
                    <div class="input-group">
                        <span class="input-prefix">$</span>
                        <input type="number" id="custom-amount-input" class="amount-input" placeholder="0" min="1"
                            max="999999999999">
                    </div>
                </div>

                <button type="button" class="btn-modal btn-accept btn-full" id="btn-confirm-add-money">
                    <i class="fa-solid fa-plus"></i>
                    Add Chips
                </button>
            </div>
        </div>
    </div>

    <!-- UI Components -->
    <div id="toast-container"></div>

    <!-- Keyboard Shortcuts Modal -->
    <div class="modal-backdrop" id="shortcuts-modal" role="dialog" aria-modal="true" aria-labelledby="shortcuts-title"
        style="display: none;">
        <div class="modal modal-shortcuts">
            <div class="modal-header">
                <h2 class="modal-title" id="shortcuts-title">Keyboard Shortcuts</h2>
                <button type="button" class="modal-close" id="btn-close-shortcuts" aria-label="Close">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="shortcuts-content">
                <div class="shortcut-group">
                    <h3 class="shortcut-group-title">Game Actions</h3>
                    <div class="shortcut-row"><kbd>H</kbd><span>Hit</span></div>
                    <div class="shortcut-row"><kbd>S</kbd><span>Stand</span></div>
                    <div class="shortcut-row"><kbd>D</kbd><span>Double Down</span></div>
                    <div class="shortcut-row"><kbd>P</kbd><span>Split</span></div>
                    <div class="shortcut-row"><kbd>R</kbd><span>Surrender</span></div>
                </div>
                <div class="shortcut-group">
                    <h3 class="shortcut-group-title">Betting</h3>
                    <div class="shortcut-row"><kbd>1</kbd><span>Add $1 chip</span></div>
                    <div class="shortcut-row"><kbd>2</kbd><span>Add $5 chip</span></div>
                    <div class="shortcut-row"><kbd>3</kbd><span>Add $25 chip</span></div>
                    <div class="shortcut-row"><kbd>4</kbd><span>Add $100 chip</span></div>
                    <div class="shortcut-row"><kbd>5</kbd><span>Add $500 chip</span></div>
                    <div class="shortcut-row"><kbd>6</kbd><span>Add $1000 chip</span></div>
                    <div class="shortcut-row"><kbd>C</kbd><span>Clear bet</span></div>
                </div>
                <div class="shortcut-group">
                    <h3 class="shortcut-group-title">Navigation</h3>
                    <div class="shortcut-row"><kbd>Enter</kbd><span>Deal / Next Round</span></div>
                    <div class="shortcut-row"><kbd>Space</kbd><span>Deal / Next Round</span></div>
                    <div class="shortcut-row"><kbd>?</kbd><span>Toggle this help</span></div>
                    <div class="shortcut-row"><kbd>Esc</kbd><span>Close modals</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Core Modules -->
    <script src="js/sounds.js"></script>
    <script src="js/themes.js"></script>
    <script src="js/deck.js"></script>
    <script src="js/game.js"></script>
    <script src="js/ui-modern.js"></script>

    <!-- App Initialization -->
    <script src="js/init.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('SW registration failed:', error);
                    });
            });
        }
    </script>
</body>

</html>